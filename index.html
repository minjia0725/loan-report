<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è³¼å±‹è²¡å‹™è©•ä¼°å ±å‘Š</title>
    <!-- Vue.js -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Microsoft JhengHei', sans-serif; background-color: #f3f4f6; }
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); padding: 20px; margin-bottom: 20px; }
        .input-group { margin-bottom: 12px; }
        .input-label { display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 4px; }
        .input-field { width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 6px; }
        .highlight { color: #2563eb; font-weight: bold; }
        .status-safe { color: #059669; background: #d1fae5; padding: 4px 8px; border-radius: 4px; font-size: 0.875rem; }
        .status-warn { color: #d97706; background: #fef3c7; padding: 4px 8px; border-radius: 4px; font-size: 0.875rem; }
        .status-danger { color: #dc2626; background: #fee2e2; padding: 4px 8px; border-radius: 4px; font-size: 0.875rem; }
    </style>
</head>
<body>
    <div id="app" class="container mx-auto p-6 max-w-7xl">
        <!-- æ¨™é¡Œå€ -->
        <div class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">1,800 è¬è³¼å±‹æ±ºç­–å…¨æ–¹ä½è²¡å‹™è©•ä¼°</h1>
            <p class="text-gray-600">é›¶ç§Ÿé‡‘ã€é«˜æ”¯å‡ºæ¨™æº–ä¸‹çš„æ¥µé™å£“åŠ›æ¸¬è©¦å ±å‘Š</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- å·¦å´åƒæ•¸è¨­å®š -->
            <div class="col-span-1">
                <div class="card">
                    <h2 class="text-xl font-bold mb-4 border-b pb-2">âš™ï¸ åƒæ•¸è¨­å®š</h2>
                    
                    <!-- æˆ¿ç”¢è³‡é‡‘ -->
                    <div class="mb-6">
                        <h3 class="text-sm font-bold text-gray-500 uppercase mb-3">æˆ¿ç”¢è³‡é‡‘æ¶æ§‹</h3>
                        <div class="input-group">
                            <label class="input-label">æˆ¿å±‹ç¸½åƒ¹ (è¬å…ƒ)</label>
                            <input type="number" v-model.number="params.housePrice" class="input-field" min="0">
                        </div>
                        <div class="input-group">
                            <label class="input-label">è£æ½¢é å‚™é‡‘ (è¬å…ƒ)</label>
                            <input type="number" v-model.number="params.decoration" class="input-field" min="0">
                        </div>
                        <div class="input-group">
                            <label class="input-label">æŠµæŠ¼è²¸æ¬¾é‡‘é¡ (è¬å…ƒ)</label>
                            <input type="number" v-model.number="params.mortgageLoan" class="input-field" min="0">
                            <p class="text-xs text-gray-500 mt-1">ç”¨æ–¼é ­æœŸæ¬¾+è£æ½¢</p>
                        </div>
                    </div>

                    <!-- è²¸æ¬¾æ¢ä»¶è©³ç´°è¨­å®š -->
                    <div class="mb-6 bg-blue-50 p-3 rounded-lg border border-blue-100">
                        <h3 class="text-sm font-bold text-blue-600 uppercase mb-3">è©³ç´°è²¸æ¬¾æ¢ä»¶</h3>
                        
                        <div class="mb-4">
                            <label class="text-xs font-bold text-gray-500 block mb-2">1. å®¶äººæŠµæŠ¼è²¸æ¬¾ (é ­æœŸ)</label>
                            <div class="grid grid-cols-2 gap-2">
                                <div class="input-group mb-0">
                                    <label class="text-xs text-gray-600">åˆ©ç‡ (%)</label>
                                    <input type="number" v-model.number="params.interestRate1" step="0.1" min="0" class="input-field text-sm">
                                </div>
                                <div class="input-group mb-0">
                                    <label class="text-xs text-gray-600">å¹´é™ (å¹´)</label>
                                    <input type="number" v-model.number="params.years1" min="1" class="input-field text-sm">
                                </div>
                            </div>
                        </div>

                        <div class="mb-0">
                            <label class="text-xs font-bold text-gray-500 block mb-2">2. è³¼å±‹è²¸æ¬¾ (å°¾æ¬¾)</label>
                            <div class="grid grid-cols-2 gap-2">
                                <div class="input-group mb-0">
                                    <label class="text-xs text-gray-600">åˆ©ç‡ (%)</label>
                                    <input type="number" v-model.number="params.interestRate2" step="0.1" min="0" class="input-field text-sm">
                                </div>
                                <div class="input-group mb-0">
                                    <label class="text-xs text-gray-600">å¹´é™ (å¹´)</label>
                                    <input type="number" v-model.number="params.years2" min="1" class="input-field text-sm">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- æ”¶å…¥è¨­å®š -->
                    <div class="mb-6">
                        <h3 class="text-sm font-bold text-gray-500 uppercase mb-3">å®¶åº­æ”¶å…¥</h3>
                        <div class="input-group">
                            <label class="input-label">å®¶åº­å¹´è–ªè³‡ (è¬å…ƒ)</label>
                            <input type="number" v-model.number="params.annualSalary" class="input-field" min="0">
                        </div>
                        <div class="input-group">
                            <label class="input-label">è–ªè³‡æˆé•·ç‡ (%) - å‰5å¹´</label>
                            <input type="number" v-model.number="params.salaryGrowth" class="input-field" min="0" step="0.1">
                        </div>
                        <div class="input-group">
                            <label class="input-label">èˆŠå±‹å¹´ç§Ÿé‡‘ (è¬å…ƒ)</label>
                            <input type="number" v-model.number="params.rentIncome" class="input-field" min="0">
                            <p class="text-xs text-gray-500 mt-1">ç›®å‰è¨­å®šç‚º 0</p>
                        </div>
                    </div>

                    <!-- æ”¯å‡ºè¨­å®š (è©³ç´°ç‰ˆ) -->
                    <div class="mb-6">
                        <h3 class="text-sm font-bold text-gray-500 uppercase mb-3">å¹´åº¦æ”¯å‡ºé ç®—ç´°é …</h3>
                        
                        <!-- 1. åŸºæœ¬ç”Ÿæ´» -->
                        <div class="mb-4 border-l-4 border-green-400 pl-3">
                            <h4 class="text-sm font-bold text-gray-700 mb-2">ğŸ  1. åŸºæœ¬ç”Ÿæ´» (æ—¥å¸¸)</h4>
                            <div class="grid grid-cols-1 gap-2">
                                <div class="input-group mb-2">
                                    <label class="input-label">é£²é£Ÿèˆ‡é›œæ”¯</label>
                                    <input type="number" v-model.number="params.expense.basic_food" class="input-field" min="0">
                                    <p class="text-xs text-gray-400 mt-1">ä¸‰é¤é£²é£Ÿã€æ—¥ç”¨å“</p>
                                </div>
                                <div class="input-group mb-0">
                                    <label class="input-label">å±…ä½é›œè²»</label>
                                    <input type="number" v-model.number="params.expense.basic_house" class="input-field" min="0">
                                    <p class="text-xs text-gray-400 mt-1">ç®¡ç†è²»ã€æ°´é›»ç“¦æ–¯</p>
                                </div>
                            </div>
                        </div>

                        <!-- 2. å¹´åº¦è²¬ä»» -->
                        <div class="mb-4 border-l-4 border-orange-400 pl-3">
                            <h4 class="text-sm font-bold text-gray-700 mb-2">â¤ï¸ 2. å¹´åº¦è²¬ä»» (å›ºå®š)</h4>
                            <div class="grid grid-cols-2 gap-2">
                                <div class="input-group mb-0">
                                    <label class="input-label">å­è¦ªè²»</label>
                                    <input type="number" v-model.number="params.expense.parents" class="input-field" min="0">
                                    <p class="text-xs text-gray-400 mt-1">ç´…åŒ…ç¦®é‡‘</p>
                                </div>
                                <div class="input-group mb-0">
                                    <label class="input-label">ä¿éšª</label>
                                    <input type="number" v-model.number="params.expense.insurance" class="input-field" min="0">
                                    <p class="text-xs text-gray-400 mt-1">å…¨å®¶ä¿å–®</p>
                                </div>
                                <div class="input-group mb-0 col-span-2">
                                    <label class="input-label">æ±½è»Šé¤Šè­·</label>
                                    <input type="number" v-model.number="params.expense.car" class="input-field" min="0">
                                    <p class="text-xs text-gray-400 mt-1">ç¨…é‡‘ã€ä¿é¤Šã€ç¶­ä¿®</p>
                                </div>
                            </div>
                        </div>

                        <!-- 3. äº«æ¨‚ç”Ÿæ´» -->
                        <div class="mb-4 border-l-4 border-pink-400 pl-3">
                            <h4 class="text-sm font-bold text-gray-700 mb-2">âœˆï¸ 3. äº«æ¨‚ç”Ÿæ´» (å½ˆæ€§)</h4>
                            <div class="grid grid-cols-1 gap-2">
                                <div class="input-group mb-2">
                                    <label class="input-label">å‡ºåœ‹æ—…éŠ</label>
                                    <input type="number" v-model.number="params.expense.travel" class="input-field" min="0">
                                    <p class="text-xs text-gray-400 mt-1">æ¯å¹´é•·é€”æ—…éŠé ç®—</p>
                                </div>
                                <div class="input-group mb-0">
                                    <label class="input-label">è³¼ç‰©å¨›æ¨‚ & æ„å¤–</label>
                                    <input type="number" v-model.number="params.expense.shopping" class="input-field" min="0">
                                    <p class="text-xs text-gray-400 mt-1">æ²»è£ã€é†«ç¾ã€å¯µç‰©ã€å®¶é›»ç¶­ä¿®</p>
                                </div>
                            </div>
                        </div>

                        <!-- 4. ç‰¹æ®Šæ”¯å‡º -->
                        <div class="mb-0 border-l-4 border-purple-400 pl-3">
                            <h4 class="text-sm font-bold text-gray-700 mb-2">ğŸ‘¶ 4. ç‰¹æ®Šæ”¯å‡º (ä¸€æ¬¡æ€§)</h4>
                            <div class="input-group mb-0">
                                <label class="input-label">æœˆå­ä¸­å¿ƒ</label>
                                <input type="number" v-model.number="params.expense.baby" class="input-field" min="0">
                                <p class="text-xs text-gray-400 mt-1">åƒ…æ–¼æ‡·å­•å¹´åº¦è¨ˆç®—</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³å´çµæœå±•ç¤º -->
            <div class="col-span-1 lg:col-span-2">
                <!-- é—œéµæŒ‡æ¨™å¡ -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="card flex flex-col justify-center items-center border-l-4 border-blue-500">
                        <div class="text-gray-500 text-sm font-bold">ç¸½æœˆä»˜é‡‘</div>
                        <div class="text-3xl font-bold text-gray-800">{{ formatMoney(monthlyPaymentTotal) }}<span class="text-sm">è¬</span></div>
                        <div class="text-xs text-gray-500 mt-1">ä½”æœˆè–ª {{ burdenRatio }}%</div>
                    </div>
                    <div class="card flex flex-col justify-center items-center border-l-4" :class="burdenRatioClass">
                        <div class="text-gray-500 text-sm font-bold">æˆ¿è²¸è² æ“”æ¯” (ç´”è–ªè³‡)</div>
                        <div class="text-3xl font-bold" :class="burdenRatioColor">{{ burdenRatio }}%</div>
                        <div class="mt-2" :class="burdenRatioStatusClass">{{ burdenRatioText }}</div>
                    </div>
                    <div class="card flex flex-col justify-center items-center border-l-4 border-green-500">
                        <div class="text-gray-500 text-sm font-bold">10å¹´ç´¯ç©ç¾é‡‘</div>
                        <div class="text-3xl font-bold text-green-600">{{ formatMoney(totalAssets10Year) }}<span class="text-sm">è¬</span></div>
                        <div class="text-xs text-gray-500 mt-1">æ‰£é™¤æ‰€æœ‰æ”¯å‡ºå¾Œæ·¨é¡</div>
                    </div>
                </div>

                <!-- è²¸æ¬¾è©¦ç®—æ˜ç´°è¡¨ (æ–°å¢) -->
                <div class="card mb-6">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        <span class="bg-blue-100 text-blue-600 p-1 rounded mr-2">ğŸ’°</span> 
                        è²¸æ¬¾è©¦ç®—æ˜ç´°
                    </h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm text-left border-collapse">
                            <thead class="bg-gray-50 text-gray-600">
                                <tr>
                                    <th class="p-3 border-b">è²¸æ¬¾é …ç›®</th>
                                    <th class="p-3 border-b">è²¸æ¬¾é‡‘é¡</th>
                                    <th class="p-3 border-b">å¹´åˆ©ç‡</th>
                                    <th class="p-3 border-b">å¹´é™</th>
                                    <th class="p-3 border-b font-bold text-blue-600 text-right">æœˆä»˜é‡‘</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b">
                                    <td class="p-3">
                                        <span class="font-bold text-gray-800">1. å®¶äººæŠµæŠ¼è²¸æ¬¾</span>
                                        <span class="block text-xs text-gray-500">é ­æœŸæ¬¾ + è£æ½¢</span>
                                    </td>
                                    <td class="p-3">{{ params.mortgageLoan }} è¬</td>
                                    <td class="p-3">{{ params.interestRate1 }}%</td>
                                    <td class="p-3">{{ params.years1 }} å¹´</td>
                                    <td class="p-3 text-right font-mono font-bold">{{ formatMoney(mortgagePayment1) }} è¬</td>
                                </tr>
                                <tr class="border-b">
                                    <td class="p-3">
                                        <span class="font-bold text-gray-800">2. è³¼å±‹è²¸æ¬¾</span>
                                        <span class="block text-xs text-gray-500">æˆ¿åƒ¹å°¾æ¬¾ (76%)</span>
                                    </td>
                                    <td class="p-3">{{ purchaseLoanAmount }} è¬</td>
                                    <td class="p-3">{{ params.interestRate2 }}%</td>
                                    <td class="p-3">{{ params.years2 }} å¹´</td>
                                    <td class="p-3 text-right font-mono font-bold">{{ formatMoney(mortgagePayment2) }} è¬</td>
                                </tr>
                                <tr class="bg-blue-50">
                                    <td class="p-3 font-bold text-gray-800">ç¸½è¨ˆ</td>
                                    <td class="p-3 font-bold">{{ params.housePrice + params.decoration }} è¬</td>
                                    <td class="p-3"></td>
                                    <td class="p-3"></td>
                                    <td class="p-3 text-right font-mono font-bold text-blue-700 text-lg">{{ formatMoney(monthlyPaymentTotal) }} è¬</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- åœ–è¡¨å€ -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <!-- æ”¯å‡ºçµæ§‹åœ“é¤…åœ– -->
                    <div class="card h-80">
                        <h3 class="text-lg font-bold mb-4">ğŸ’¸ å¹´åº¦æ”¯å‡ºçµæ§‹åˆ†æ</h3>
                        <div class="h-64 relative">
                            <canvas id="expenseChart"></canvas>
                        </div>
                    </div>
                    <!-- è³‡ç”¢ç´¯ç©åœ– -->
                    <div class="card h-80">
                        <h3 class="text-lg font-bold mb-4">ğŸ“ˆ åå¹´è³‡ç”¢ç´¯ç©è¶¨å‹¢</h3>
                        <div class="h-64 relative">
                            <canvas id="assetChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- è©³ç´°æ•¸æ“šè¡¨ -->
                <div class="card mb-8">
                    <h3 class="text-lg font-bold mb-4">ğŸ“Š ç¾é‡‘æµæ¨¡æ“¬æ˜ç´° (è¬å…ƒ)</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm text-left">
                            <thead class="bg-gray-100 text-gray-600 font-bold">
                                <tr>
                                    <th class="p-3">å¹´åº¦</th>
                                    <th class="p-3">èªªæ˜</th>
                                    <th class="p-3">ç¸½æ”¶å…¥</th>
                                    <th class="p-3">æˆ¿è²¸æ”¯å‡º</th>
                                    <th class="p-3">ç”Ÿæ´»äº«æ¨‚</th>
                                    <th class="p-3">ç•¶åº¦çµé¤˜</th>
                                    <th class="p-3">ç´¯ç©è³‡ç”¢</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="year in simulationData" :key="year.year" class="border-b hover:bg-gray-50">
                                    <td class="p-3 font-bold">Y{{ year.year }}</td>
                                    <td class="p-3">
                                        <span v-if="year.note" class="px-2 py-1 rounded text-xs" :class="year.noteClass">{{ year.note }}</span>
                                    </td>
                                    <td class="p-3">{{ formatMoney(year.income) }}</td>
                                    <td class="p-3">{{ formatMoney(year.mortgage) }}</td>
                                    <td class="p-3">{{ formatMoney(year.living) }}</td>
                                    <td class="p-3 font-bold" :class="year.balance >= 0 ? 'text-green-600' : 'text-red-600'">
                                        {{ year.balance >= 0 ? '+' : '' }}{{ formatMoney(year.balance) }}
                                    </td>
                                    <td class="p-3 font-bold text-blue-600">{{ formatMoney(year.assets) }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- æ•´åˆ PPT å ±å‘Šå…§å®¹ -->
                <div class="bg-white rounded-xl shadow-lg p-8 mb-8 border-t-4 border-indigo-600">
                    <div class="text-center mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">è³¼å±‹æ±ºç­–å…¨æ–¹ä½è²¡å‹™è©•ä¼°å ±å‘Š</h2>
                        <p class="text-gray-500">é›¶ç§Ÿé‡‘ã€é«˜æ”¯å‡ºæ¨™æº–ä¸‹çš„æ¥µé™å£“åŠ›æ¸¬è©¦</p>
                    </div>

                    <div class="space-y-8">
                        <!-- P1 æ‘˜è¦ -->
                        <section>
                            <h3 class="text-xl font-bold text-indigo-700 mb-3 border-b pb-1">1. å ±å‘Šæ‘˜è¦ (Executive Summary)</h3>
                            <ul class="list-disc list-inside text-gray-700 space-y-1 pl-2">
                                <li><strong class="text-gray-900">æ±ºç­–ç›®æ¨™ï¼š</strong>è³¼å…¥ç¸½åƒ¹ <span class="font-bold text-blue-600">{{ params.housePrice }}è¬</span> æˆ¿ç”¢ä¹‹å¯è¡Œæ€§è©•ä¼°ã€‚</li>
                                <li><strong class="text-gray-900">è³‡é‡‘ç­–ç•¥ï¼š</strong>æ¡ã€Œé›™è²¸æ¬¾æ¨¡å¼ã€ï¼Œä»¥å®¶äººæŠµæŠ¼è²¸æ¬¾ ({{ params.mortgageLoan }}è¬) ä½œç‚ºé ­æœŸæ¬¾ã€‚</li>
                                <li><strong class="text-gray-900">æ ¸å¿ƒçµè«–ï¼š</strong>
                                    <ul class="list-circle list-inside pl-5 mt-1 text-sm text-gray-600">
                                        <li><strong class="text-green-600">è² æ“”å®‰å…¨ï¼š</strong>ç´”è–ªè³‡è² æ“”æ¯”ç´„ {{ burdenRatio }}%ï¼Œç¬¦åˆç†è²¡é»ƒé‡‘æ¯”ä¾‹ã€‚</li>
                                        <li><strong class="text-green-600">ç”Ÿæ´»å¯Œè£•ï¼š</strong>é ç®—åŒ…å«æ¯å¹´é«˜é¡æ—…éŠèˆ‡å­è¦ªè²»ï¼Œç”Ÿæ´»å“è³ªä¸æ‰“æŠ˜ã€‚</li>
                                        <li><strong class="text-green-600">è³‡ç”¢ç©©å¥ï¼š</strong>10 å¹´å¾Œé ä¼°ç´¯ç© {{ formatMoney(totalAssets10Year) }} è¬ç¾é‡‘ã€‚</li>
                                    </ul>
                                </li>
                            </ul>
                        </section>

                        <!-- P2 è³‡é‡‘æ¶æ§‹ -->
                        <section>
                            <h3 class="text-xl font-bold text-indigo-700 mb-3 border-b pb-1">2. è³‡é‡‘ä¾†æºèˆ‡æ¶æ§‹</h3>
                            <p class="text-gray-700 mb-2">ç­–ç•¥ï¼šæŠµæŠ¼è²¸æ¬¾é‡‘é¡è¨­å®šç‚º {{ params.mortgageLoan }} è¬ï¼Œç¢ºä¿é ­æœŸæ¬¾å……è¶³ä¸¦é ç•™è£æ½¢é‡‘ã€‚</p>
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <div class="flex justify-between mb-2 border-b pb-2">
                                    <span>1. é ­æœŸ+è£æ½¢ (å®¶äººæŠµæŠ¼)</span>
                                    <span class="font-bold">{{ params.mortgageLoan }} è¬ ({{ params.interestRate1 }}% / {{ params.years1 }}å¹´)</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>2. è³¼å±‹å°¾æ¬¾ (ä¸€èˆ¬æˆ¿è²¸)</span>
                                    <span class="font-bold">{{ purchaseLoanAmount }} è¬ ({{ params.interestRate2 }}% / {{ params.years2 }}å¹´)</span>
                                </div>
                            </div>
                        </section>

                        <!-- P3 é¢¨éšªæ§ç®¡ -->
                        <section>
                            <h3 class="text-xl font-bold text-indigo-700 mb-3 border-b pb-1">3. é¢¨éšªæ§ç®¡èˆ‡å°ç­–</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="bg-red-50 p-4 rounded-lg">
                                    <h4 class="font-bold text-red-700 mb-2">å®¶äººæŠµæŠ¼è²¸æ¬¾é¢¨éšª</h4>
                                    <p class="text-sm text-gray-700">å°ç­–ï¼šç¾é‡‘æµå……è£•ï¼Œç¬¬ 5 å¹´ç´¯ç©ç¾é‡‘å·²è¶…éæŠµæŠ¼ç¸½é¡ï¼Œéš¨æ™‚æœ‰èƒ½åŠ›ä¸€æ¬¡æ¸…å„Ÿã€‚</p>
                                </div>
                                <div class="bg-yellow-50 p-4 rounded-lg">
                                    <h4 class="font-bold text-yellow-700">åˆ©ç‡è®Šå‹•é¢¨éšª</h4>
                                    <p class="text-sm text-gray-700 mt-2">å°ç­–ï¼šå³ä½¿å‡æ¯ 1%ï¼Œæœˆä»˜å¢åŠ æœ‰é™ï¼Œç›¸è¼ƒæ–¼æ¯æœˆåå¹¾è¬çš„çµé¤˜ï¼Œå½±éŸ¿å¾®ä¹å…¶å¾®ã€‚</p>
                                </div>
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <h4 class="font-bold text-blue-700">ç§Ÿé‡‘ä¸­æ–·é¢¨éšª</h4>
                                    <p class="text-sm text-gray-700 mt-2">å°ç­–ï¼šæœ¬å ±å‘Šå·²å‡è¨­ã€Œå®Œå…¨ç„¡ç§Ÿé‡‘ã€ï¼Œè­‰æ˜ä¸é ç§Ÿé‡‘ä¹Ÿèƒ½è¼•é¬†éæ´»ã€‚</p>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;

        createApp({
            setup() {
                // åƒæ•¸è¨­å®š
                const params = ref({
                    housePrice: 1800,
                    decoration: 100,
                    mortgageLoan: 460, // æŠµæŠ¼è²¸æ¬¾ (é ­æœŸ+è£æ½¢)
                    interestRate1: 3.5, // æŠµæŠ¼åˆ©ç‡
                    years1: 20,
                    interestRate2: 3.5, // è³¼å±‹åˆ©ç‡
                    years2: 40,
                    
                    annualSalary: 300,
                    salaryGrowth: 7,
                    rentIncome: 0,
                    
                    expense: {
                        basic_food: 30, // é£²é£Ÿé›œæ”¯
                        basic_house: 9, // ç®¡ç†æ°´é›»
                        parents: 13,
                        shopping: 35,
                        travel: 20,
                        insurance: 15,
                        car: 3,
                        baby: 20
                    }
                });

                // è¨ˆç®—é‚è¼¯
                const loanAmount2 = computed(() => params.value.housePrice + params.value.decoration - params.value.mortgageLoan); 
                const purchaseLoanAmount = computed(() => 1440); // å›ºå®šç‚º 1440 æˆ–æ ¹æ“šè¼¸å…¥è¨ˆç®—: params.value.housePrice + params.value.decoration - params.value.mortgageLoan
                // ä¿®æ­£ï¼šé€™è£¡å‹•æ…‹è¨ˆç®—æ¯”è¼ƒå¥½ï¼Œé›–ç„¶æˆ‘å€‘å ±å‘Šé è¨­æ˜¯ 1440ï¼Œä½†å¦‚æœä½¿ç”¨è€…æ”¹äº†æˆ¿åƒ¹ï¼Œé€™è£¡ä¹Ÿè¦è®Š
                // é‚è¼¯ï¼šç¸½éœ€æ±‚ = æˆ¿åƒ¹ + è£æ½¢ã€‚ ç¸½è²¸æ¬¾ = æŠµæŠ¼ + è³¼å±‹ã€‚
                // æ‰€ä»¥ è³¼å±‹è²¸æ¬¾ = (æˆ¿åƒ¹ + è£æ½¢) - æŠµæŠ¼è²¸æ¬¾
                const purchaseLoan = computed(() => params.value.housePrice + params.value.decoration - params.value.mortgageLoan);


                // æˆ¿è²¸è¨ˆç®—å‡½æ•¸
                const calculateMonthlyPayment = (principal, rate, years) => {
                    if(principal <= 0) return 0;
                    const r = rate / 100 / 12;
                    const n = years * 12;
                    return principal * (r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
                };

                const mortgagePayment1 = computed(() => calculateMonthlyPayment(params.value.mortgageLoan, params.value.interestRate1, params.value.years1));
                const mortgagePayment2 = computed(() => calculateMonthlyPayment(purchaseLoan.value, params.value.interestRate2, params.value.years2));
                const monthlyPaymentTotal = computed(() => mortgagePayment1.value + mortgagePayment2.value);
                
                // è² æ“”æ¯”
                const monthlySalary = computed(() => params.value.annualSalary / 12);
                const burdenRatio = computed(() => ((monthlyPaymentTotal.value / monthlySalary.value) * 100).toFixed(1));
                
                const burdenRatioClass = computed(() => {
                    if (burdenRatio.value < 30) return 'border-green-500';
                    if (burdenRatio.value <= 33) return 'border-green-500'; // å¥åº·
                    if (burdenRatio.value <= 40) return 'border-yellow-500';
                    return 'border-red-500';
                });
                
                const burdenRatioColor = computed(() => {
                    if (burdenRatio.value <= 33) return 'text-green-600';
                    if (burdenRatio.value <= 40) return 'text-yellow-600';
                    return 'text-red-600';
                });

                const burdenRatioText = computed(() => {
                    if (burdenRatio.value < 30) return 'éå¸¸è¼•é¬† (å„ª)';
                    if (burdenRatio.value <= 33) return 'å¥åº·æ°´ä½ (è‰¯)';
                    if (burdenRatio.value <= 40) return 'è² æ“”é©ä¸­ (å¯)';
                    return 'è² æ“”æ²ˆé‡ (å±)';
                });
                
                const burdenRatioStatusClass = computed(() => {
                    if (burdenRatio.value <= 33) return 'status-safe';
                    if (burdenRatio.value <= 40) return 'status-warn';
                    return 'status-danger';
                });

                // æ¨¡æ“¬æ•¸æ“š
                const simulationData = computed(() => {
                    const data = [];
                    let currentSalary = params.value.annualSalary;
                    let accumulated = 0;
                    
                    // ç”Ÿæ´»æ”¯å‡ºç¸½åˆ (ä¸å«æˆ¿è²¸)
                    const e = params.value.expense;
                    let currentLiving = e.basic_food + e.basic_house + e.parents + e.shopping + e.travel + e.insurance + e.car; 
                    
                    for(let year = 1; year <= 10; year++) {
                        // è–ªè³‡æˆé•· (å‰5å¹´)
                        if(year > 1 && year <= 5) {
                            currentSalary *= (1 + params.value.salaryGrowth / 100);
                        }
                        
                        // æ”¯å‡ºé€šè†¨
                        if(year > 1) {
                            currentLiving *= 1.03;
                        }

                        let actualSalary = currentSalary;
                        let note = "";
                        let noteClass = "";
                        let extraExpense = 0;

                        // ç¬¬3å¹´æ‡·å­•æ¨¡æ“¬
                        if(year === 3) {
                            note = "ğŸ‘¼ æ‡·å­•è‚²å¬°";
                            noteClass = "bg-pink-100 text-pink-800";
                            // å¥³æ–¹(60%) è«‹å‡5å€‹æœˆé ˜8æˆè–ª
                            // æå¤± = å¥³æ–¹æœˆè–ª * 5 * 0.2
                            // ç°¡å–®ç®—ï¼šç¸½å¹´è–ª * 0.6 / 12 * 5 * 0.2 = å¹´è–ª * 0.05
                            const loss = currentSalary * 0.05; 
                            actualSalary -= loss;
                            extraExpense = e.baby;
                        } else if (year <= 5) {
                            note = "ğŸ“ˆ è–ªè³‡æˆé•·";
                            noteClass = "bg-blue-100 text-blue-800";
                        } else {
                            note = "â– è–ªè³‡æŒå¹³";
                            noteClass = "bg-gray-100 text-gray-600";
                        }

                        const totalIncome = actualSalary + params.value.rentIncome;
                        const annualMortgage = monthlyPaymentTotal.value * 12;
                        const totalExpense = annualMortgage + currentLiving + extraExpense;
                        const balance = totalIncome - totalExpense;
                        accumulated += balance;

                        data.push({
                            year,
                            note,
                            noteClass,
                            income: totalIncome,
                            mortgage: annualMortgage,
                            living: currentLiving + extraExpense,
                            balance,
                            assets: accumulated
                        });
                    }
                    return data;
                });

                const totalAssets10Year = computed(() => {
                    return simulationData.value[9].assets;
                });

                // åœ–è¡¨ç›¸é—œ
                let expenseChartInstance = null;
                let assetChartInstance = null;

                const updateCharts = () => {
                    // 1. æ”¯å‡ºåœ“é¤…åœ–
                    const ctxExpense = document.getElementById('expenseChart');
                    if(ctxExpense) {
                        if(expenseChartInstance) expenseChartInstance.destroy();
                        
                        const e = params.value.expense;
                        const annualMortgage = monthlyPaymentTotal.value * 12;
                        const annualLiving = e.basic_food + e.basic_house + e.car; // åŸºæœ¬ç”Ÿæ´» (å«è»Š)
                        const annualEnjoy = e.shopping + e.travel; // äº«æ¨‚
                        const annualDuty = e.parents + e.insurance; // è²¬ä»»
                        
                        expenseChartInstance = new Chart(ctxExpense, {
                            type: 'doughnut',
                            data: {
                                labels: ['æˆ¿è²¸æ”¯å‡º', 'é«˜ç«¯äº«æ¨‚', 'å¹´åº¦è²¬ä»»', 'åŸºæœ¬ç”Ÿæ´»'],
                                datasets: [{
                                    data: [annualMortgage, annualEnjoy, annualDuty, annualLiving],
                                    backgroundColor: ['#3b82f6', '#ec4899', '#f59e0b', '#10b981']
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: { position: 'bottom' }
                                }
                            }
                        });
                    }

                    // 2. è³‡ç”¢ç´¯ç©åœ–
                    const ctxAsset = document.getElementById('assetChart');
                    if(ctxAsset) {
                        if(assetChartInstance) assetChartInstance.destroy();
                        
                        const labels = simulationData.value.map(d => `Y${d.year}`);
                        const assets = simulationData.value.map(d => d.assets);
                        // åˆ¤æ–·é¡è‰²ï¼šè² å€¼ç‚ºç´…è‰²ï¼Œæ­£å€¼ç‚ºç¶ è‰²
                        const colors = assets.map(a => a < 0 ? '#ef4444' : '#10b981');
                        
                        assetChartInstance = new Chart(ctxAsset, {
                            type: 'bar',
                            data: {
                                labels: labels,
                                datasets: [{
                                    label: 'ç´¯ç©ç¾é‡‘è³‡ç”¢ (è¬å…ƒ)',
                                    data: assets,
                                    backgroundColor: colors,
                                    borderRadius: 4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: { display: false }
                                }
                            }
                        });
                    }
                };

                // ç›£è½æ•¸æ“šè®ŠåŒ–æ›´æ–°åœ–è¡¨
                watch(simulationData, () => {
                    // ä½¿ç”¨ nextTick æˆ– setTimeout ç¢ºä¿ DOM æ›´æ–°
                    setTimeout(updateCharts, 100);
                }, { deep: true });

                onMounted(() => {
                    updateCharts();
                });

                const formatMoney = (val) => {
                    return val.toFixed(1);
                };

                return {
                    params,
                    monthlyPaymentTotal,
                    mortgagePayment1,
                    mortgagePayment2,
                    burdenRatio,
                    burdenRatioClass,
                    burdenRatioColor,
                    burdenRatioText,
                    burdenRatioStatusClass,
                    simulationData,
                    totalAssets10Year,
                    formatMoney,
                    purchaseLoanAmount: purchaseLoan
                };
            }
        }).mount('#app');
    </script>
</body>
</html>

